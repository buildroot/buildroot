From 36ef37248c1608a366846d17d60fec217e515377 Mon Sep 17 00:00:00 2001
From: GHANNADZADEH Saman <saman.ghannadzadeh@oxinst.com>
Date: Mon, 4 Mar 2019 16:28:36 +0000
Subject: [PATCH] Build Debian packages using CPack

Upstream: https://github.com/darrenjs/wampcc/commit/36ef37248c1608a366846d17d60fec217e515377

Signed-off-by: Bernd Kuhls <bernd@kuhls.net>
---
 CMakeLists.txt              |  5 ++++-
 cmake/MakeDebPackages.cmake | 26 ++++++++++++++++++++++++++
 2 files changed, 30 insertions(+), 1 deletion(-)
 create mode 100644 cmake/MakeDebPackages.cmake

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 0a8b528d..a9fb364c 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -7,7 +7,7 @@ project(wampcc VERSION ${WAMPCC_VERSION})
 
 # Version number
 # Include extra cmake modules
-set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_SOURCE_DIR}/cmake")
+set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_CURRENT_LIST_DIR}/cmake")
 
 
 ##
@@ -37,6 +37,9 @@ set(INSTALL_LIB_DIR "${CMAKE_INSTALL_PREFIX}/lib" CACHE PATH  "Installation dire
 set(INSTALL_INC_DIR "${CMAKE_INSTALL_PREFIX}/include" CACHE PATH "Installation directory for headers")
 set(INSTALL_PKGCONFIG_DIR "${CMAKE_INSTALL_PREFIX}/lib/pkgconfig" CACHE PATH "Installation directory for pkgconfig (.pc) files")
 
+# Allow settin of RPATH for install
+SET(CMAKE_INSTALL_RPATH_USE_LINK_PATH TRUE)
+
 ##
 ## Platform checks, and generate config.h
 ##
diff --git a/cmake/MakeDebPackages.cmake b/cmake/MakeDebPackages.cmake
new file mode 100644
index 00000000..66ecb336
--- /dev/null
+++ b/cmake/MakeDebPackages.cmake
@@ -0,0 +1,26 @@
+set(CPACK_PACKAGE_VENDOR "Darren Smith")
+SET(CPACK_PACKAGE_CONTACT "Darren Smith")
+
+set(CPACK_PACKAGING_INSTALL_PREFIX "/usr/lib")
+
+SET(CPACK_GENERATOR "DEB")
+SET(CPACK_DEBIAN_FILE_NAME DEB-DEFAULT)
+set(CPACK_DEBIAN_PACKAGE_SHLIBDEPS ON)
+set(CPACK_DEBIAN_PACKAGE_GENERATE_SHLIBS ON)
+
+set(CPACK_DEB_COMPONENT_INSTALL ON)
+set(CPACK_DEBIAN_ENABLE_COMPONENT_DEPENDS YES)
+
+set(CPACK_COMPONENTS_ALL lib dev)
+set(CPACK_COMPONENT_DEV_DEPENDS lib)
+
+set(CPACK_DEBIAN_LIB_PACKAGE_NAME libwampcc)
+set(CPACK_DEBIAN_DEV_PACKAGE_NAME libwampcc-dev)
+
+if(BUILD_UTILS)
+  list(APPEND CPACK_COMPONENTS_ALL util)
+  set(CPACK_COMPONENT_UTIL_DEPENDS lib)
+  set(CPACK_DEBIAN_UTIL_PACKAGE_NAME wampcc-utils)
+endif()
+
+include(CPack)
