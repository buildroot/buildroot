From 45f2a79f4265dcc4f98cfbafdb10727fb1c0d411 Mon Sep 17 00:00:00 2001
From: "Tom M." <tom.mbrt@googlemail.com>
Date: Mon, 14 Jul 2025 18:13:38 +0200
Subject: [PATCH] Fix a nullpointer dereference during legato mode (#1607)

CVE: CVE-2025-56225
Upstream: https://github.com/FluidSynth/fluidsynth/commit/45f2a79f4265dcc4f98cfbafdb10727fb1c0d411
Signed-off-by: Thomas Perale <thomas.perale@mind.be>
---
 src/synth/fluid_synth_monopoly.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/synth/fluid_synth_monopoly.c b/src/synth/fluid_synth_monopoly.c
index d1de13196..6e6e2a906 100644
--- a/src/synth/fluid_synth_monopoly.c
+++ b/src/synth/fluid_synth_monopoly.c
@@ -410,7 +410,7 @@ int fluid_synth_noteoff_mono_LOCAL(fluid_synth_t *synth, int chan, int key)
                 fluid_channel_breath_msb(channel))
         {
             /* legato playing detection */
-            if(channel->mode  & FLUID_CHANNEL_LEGATO_PLAYING)
+            if (channel->mode & FLUID_CHANNEL_LEGATO_PLAYING && channel->preset != NULL)
             {
                 /* the list contains others notes */
                 if(i_prev >= 0)
