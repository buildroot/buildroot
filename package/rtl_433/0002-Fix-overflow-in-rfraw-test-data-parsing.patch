From 25e47f8932f0401392ef1d3c8cc9ed5595bc894a Mon Sep 17 00:00:00 2001
From: "Christian W. Zuckschwerdt" <christian@zuckschwerdt.org>
Date: Wed, 8 Oct 2025 10:11:15 +0200
Subject: [PATCH] Fix overflow in rfraw test data parsing (closes #3375)

CVE: CVE-2025-34450
Upstream: https://github.com/merbanan/rtl_433/commit/25e47f8932f0401392ef1d3c8cc9ed5595bc894a
Signed-off-by: Thomas Perale <thomas.perale@mind.be>
---
 src/rfraw.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/rfraw.c b/src/rfraw.c
index 9f4c9780c..71a1c365d 100644
--- a/src/rfraw.c
+++ b/src/rfraw.c
@@ -159,9 +159,14 @@ static bool parse_rfraw(pulse_data_t *data, char const **p)
             data->num_pulses++;
             pulse_needed = true;
         }
+        // abort reading if the pulse data array is full
+        if (data->num_pulses >= PD_MAX_PULSES) {
+            break;
+        }
     }
     //data->gap[data->num_pulses - 1] = 3000; // TODO: extend last gap?
 
+    // expand reapeats as long as the pulse data array has enough space
     unsigned pkt_pulses = data->num_pulses - prev_pulses;
     for (int i = 1; i < repeats && data->num_pulses + pkt_pulses <= PD_MAX_PULSES; ++i) {
         memcpy(&data->pulse[data->num_pulses], &data->pulse[prev_pulses], pkt_pulses * sizeof (*data->pulse));
