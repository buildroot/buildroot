From c24c08c9aa0f92213793e5ef404f2c387603d7f8 Mon Sep 17 00:00:00 2001
From: Ozkan Sezer <sezeroz@gmail.com>
Date: Sat, 18 Jun 2022 14:55:00 +0300
Subject: [PATCH] SDL_x11yuv.c: fix possible use-after-free

Fixes: https://github.com/libsdl-org/SDL-1.2/issues/863
Upstream: d7e00208738a0bc6af302723fe64908ac35b777b
Signed-off-by: Peter Korsgaard <peter@korsgaard.com>
---
 src/video/x11/SDL_x11yuv.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/video/x11/SDL_x11yuv.c b/src/video/x11/SDL_x11yuv.c
index 62698dfd..0d5754e3 100644
--- a/src/video/x11/SDL_x11yuv.c
+++ b/src/video/x11/SDL_x11yuv.c
@@ -374,8 +374,8 @@ SDL_Overlay *X11_CreateYUVOverlay(_THIS, int width, int height, Uint32 format, S
 #ifdef PITCH_WORKAROUND
 		if ( hwdata->image != NULL && hwdata->image->pitches[0] != (width*bpp) ) {
 			/* Ajust overlay width according to pitch */ 
-			XFree(hwdata->image);
 			width = hwdata->image->pitches[0] / bpp;
+			XFree(hwdata->image);
 			hwdata->image = SDL_NAME(XvCreateImage)(GFX_Display, xv_port, format,
 								0, width, height);
 		}
-- 
2.50.1

