CVE: CVE-2023-47995
Upstream: https://src.fedoraproject.org/rpms/freeimage/raw/rawhide/f/CVE-2023-47995.patch
Signed-off-by: Thomas Perale <thomas.perale@mind.be>
---
diff -rupN a/Source/FreeImage/PluginJPEG.cpp b/Source/FreeImage/PluginJPEG.cpp
--- a/Source/FreeImage/PluginJPEG.cpp
+++ b/Source/FreeImage/PluginJPEG.cpp
@@ -1196,6 +1196,10 @@ Load(FreeImageIO *io, fi_handle handle,
 
 			jpeg_read_header(&cinfo, TRUE);
 
+			if (cinfo.image_width > JPEG_MAX_DIMENSION || cinfo.image_height > JPEG_MAX_DIMENSION) {
+				throw FI_MSG_ERROR_DIB_MEMORY;
+			}
+
 			// step 4: set parameters for decompression
 
 			unsigned int scale_denom = 1;		// fraction by which to scale image
